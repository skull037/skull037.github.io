(function(a,b){if(typeof define==="function"&&define.amd){define("p5.dom",["p5"],function(c){b(c)})}else{if(typeof exports==="object"){b(require("../p5"))}else{b(a.p5)}}})(this,function(b){b.prototype.select=function(j,i){b._validateParameters("select",arguments);var h=null;var g=f(i);if(j[0]==="."){j=j.slice(1);h=g.getElementsByClassName(j);if(h.length){h=h[0]}else{h=null}}else{if(j[0]==="#"){j=j.slice(1);h=g.getElementById(j)}else{h=g.getElementsByTagName(j);if(h.length){h=h[0]}else{h=null}}}if(h){return this._wrapElement(h)}else{return null}};b.prototype.selectAll=function(n,m){b._validateParameters("selectAll",arguments);var g=[];var k;var h=f(m);if(n[0]==="."){n=n.slice(1);k=h.getElementsByClassName(n)}else{k=h.getElementsByTagName(n)}if(k){for(var i=0;i<k.length;i++){var l=this._wrapElement(k[i]);g.push(l)}}return g};function f(h){var g=document;if(typeof h==="string"&&h[0]==="#"){h=h.slice(1);g=document.getElementById(h)||document}else{if(h instanceof b.Element){g=h.elt}else{if(h instanceof HTMLElement){g=h}}}return g}b.prototype._wrapElement=function(g){var h=Array.prototype.slice.call(g.children);if(g.tagName==="INPUT"&&g.type==="checkbox"){var i=new b.Element(g);i.checked=function(){if(arguments.length===0){return this.elt.checked}else{if(arguments[0]){this.elt.checked=true}else{this.elt.checked=false}}return this};return i}else{if(g.tagName==="VIDEO"||g.tagName==="AUDIO"){return new b.MediaElement(g)}else{if(g.tagName==="SELECT"){return this.createSelect(new b.Element(g))}else{if(h.length>0&&h.every(function(j){return j.tagName==="INPUT"||j.tagName==="LABEL"})){return this.createRadio(new b.Element(g))}else{return new b.Element(g)}}}}};b.prototype.removeElements=function(h){b._validateParameters("removeElements",arguments);for(var g=0;g<this._elements.length;g++){if(!(this._elements[g].elt instanceof HTMLCanvasElement)){this._elements[g].remove()}}};function d(g,h,j){var i=h._userNode?h._userNode:document.body;i.appendChild(g);var k=j?new b.MediaElement(g):new b.Element(g);h._elements.push(k);return k}var a=["div","p","span"];a.forEach(function(g){var h="create"+g.charAt(0).toUpperCase()+g.slice(1);b.prototype[h]=function(j){var i=document.createElement(g);i.innerHTML=typeof j==="undefined"?"":j;return d(i,this)}});b.prototype.createImg=function(){b._validateParameters("createImg",arguments);var i=document.createElement("img");var h=arguments;var g;var j=function(){g.width=i.offsetWidth||i.width;g.height=i.offsetHeight||i.height;if(h.length>1&&typeof h[1]==="function"){g.fn=h[1];g.fn()}else{if(h.length>1&&typeof h[2]==="function"){g.fn=h[2];g.fn()}}};i.src=h[0];if(h.length>1&&typeof h[1]==="string"){i.alt=h[1]}i.onload=function(){j()};g=d(i,this);return g};b.prototype.createA=function(g,i,j){b._validateParameters("createA",arguments);var h=document.createElement("a");h.href=g;h.innerHTML=i;if(j){h.target=j}return d(h,this)};b.prototype.createSlider=function(i,g,k,j){b._validateParameters("createSlider",arguments);var h=document.createElement("input");h.type="range";h.min=i;h.max=g;if(j===0){h.step=1e-18}else{if(j){h.step=j}}if(typeof k==="number"){h.value=k}return d(h,this)};b.prototype.createButton=function(h,i){b._validateParameters("createButton",arguments);var g=document.createElement("button");g.innerHTML=h;if(i){g.value=i}return d(g,this)};b.prototype.createCheckbox=function(){b._validateParameters("createCheckbox",arguments);var j=document.createElement("div");var k=document.createElement("input");k.type="checkbox";j.appendChild(k);var h=d(j,this);h.checked=function(){var l=h.elt.getElementsByTagName("input")[0];if(l){if(arguments.length===0){return l.checked}else{if(arguments[0]){l.checked=true}else{l.checked=false}}}return h};this.value=function(l){h.value=l;return this};if(arguments[0]){var g=Math.random().toString(36).slice(2);var i=document.createElement("label");k.setAttribute("id",g);i.htmlFor=g;h.value(arguments[0]);i.appendChild(document.createTextNode(arguments[0]));j.appendChild(i)}if(arguments[1]){k.checked=true}return h};b.prototype.createSelect=function(){b._validateParameters("createSelect",arguments);var i,h;var g=arguments[0];if(typeof g==="object"&&g.elt.nodeName==="SELECT"){h=g;i=this.elt=g.elt}else{i=document.createElement("select");if(g&&typeof g==="boolean"){i.setAttribute("multiple","true")}h=d(i,this)}h.option=function(k,n){var j;for(var m=0;m<this.elt.length;m++){if(this.elt[m].innerHTML===k){j=m;break}}if(j!==undefined){if(n===false){this.elt.remove(j)}else{if(this.elt[j].innerHTML===this.elt[j].value){this.elt[j].innerHTML=this.elt[j].value=n}else{this.elt[j].value=n}}}else{var l=document.createElement("option");l.innerHTML=k;if(arguments.length>1){l.value=n}else{l.value=k}i.appendChild(l)}};h.selected=function(l){var j=[],k;if(arguments.length>0){for(k=0;k<this.elt.length;k++){if(l.toString()===this.elt[k].value){this.elt.selectedIndex=k}}return this}else{if(this.elt.getAttribute("multiple")){for(k=0;k<this.elt.selectedOptions.length;k++){j.push(this.elt.selectedOptions[k].value)}return j}else{return this.elt.value}}};return h};b.prototype.createRadio=function(q){b._validateParameters("createRadio",arguments);var o=document.querySelectorAll("input[type=radio]");var m=0;if(o.length>1){var h=o.length;var j=o[0].name;var n=o[1].name;m=1;for(var l=1;l<h;l++){n=o[l].name;if(j!==n){m++}j=n}}else{if(o.length===1){m=1}}var k,p;if(typeof q==="object"){p=q;k=this.elt=q.elt}else{k=document.createElement("div");p=d(k,this)}p._getInputChildrenArray=function(){return Array.prototype.slice.call(this.elt.children).filter(function(i){return i.tagName==="INPUT"})};var g=-1;p.option=function(r,t){var s=document.createElement("input");s.type="radio";s.innerHTML=r;if(t){s.value=t}else{s.value=r}s.setAttribute("name","defaultradio"+m);k.appendChild(s);if(r){g++;var i=document.createElement("label");s.setAttribute("id","defaultradio"+m+"-"+g);i.htmlFor="defaultradio"+m+"-"+g;i.appendChild(document.createTextNode(r));k.appendChild(i)}return s};p.selected=function(t){var s;var r=p._getInputChildrenArray();if(t){for(s=0;s<r.length;s++){if(r[s].value===t){r[s].checked=true}}return this}else{for(s=0;s<r.length;s++){if(r[s].checked===true){return r[s].value}}}};p.value=function(t){var s;var r=p._getInputChildrenArray();if(t){for(s=0;s<r.length;s++){if(r[s].value===t){r[s].checked=true}}return this}else{for(s=0;s<r.length;s++){if(r[s].checked===true){return r[s].value}}return""}};return p};b.prototype.createInput=function(i,h){b._validateParameters("createInput",arguments);var g=document.createElement("input");g.type=h?h:"text";if(i){g.value=i}return d(g,this)};b.prototype.createFileInput=function(j,g){b._validateParameters("createFileInput",arguments);function i(l){function m(r){var q=new b.File(r);return function(s){q.data=s.target.result;j(q)}}var o=l.target.files;for(var n=0;n<o.length;n++){var p=o[n];var k=new FileReader();k.onload=m(p);if(p.type.indexOf("text")>-1){k.readAsText(p)}else{k.readAsDataURL(p)}}}if(window.File&&window.FileReader&&window.FileList&&window.Blob){var h=document.createElement("input");h.type="file";if(g){h.multiple="multiple"}h.addEventListener("change",i,false);return d(h,this)}else{console.log("The File APIs are not fully supported in this browser. Cannot create element.")}};function e(j,o,g,p){var l=document.createElement(o);g=g||"";if(typeof g==="string"){g=[g]}for(var m=0;m<g.length;m++){var h=document.createElement("source");h.src=g[m];l.appendChild(h)}if(typeof p!=="undefined"){var k=function(){p();l.removeEventListener("canplaythrough",k)};l.addEventListener("canplaythrough",k)}var n=d(l,j,true);n.loadedmetadata=false;l.addEventListener("loadedmetadata",function(){n.width=l.videoWidth;n.height=l.videoHeight;if(n.elt.width===0){n.elt.width=l.videoWidth}if(n.elt.height===0){n.elt.height=l.videoHeight}n.loadedmetadata=true});return n}b.prototype.createVideo=function(g,h){b._validateParameters("createVideo",arguments);return e(this,"video",g,h)};b.prototype.createAudio=function(g,h){b._validateParameters("createAudio",arguments);return e(this,"audio",g,h)};b.prototype.VIDEO="video";b.prototype.AUDIO="audio";if(navigator.mediaDevices===undefined){navigator.mediaDevices={}}if(navigator.mediaDevices.getUserMedia===undefined){navigator.mediaDevices.getUserMedia=function(h){var g=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;if(!g){return Promise.reject(new Error("getUserMedia is not implemented in this browser"))}return new Promise(function(j,i){g.call(navigator,h,j,i)})}}b.prototype.createCapture=function(){b._validateParameters("createCapture",arguments);var l=true;var k=true;var n;var g;for(var j=0;j<arguments.length;j++){if(arguments[j]===b.prototype.VIDEO){k=false}else{if(arguments[j]===b.prototype.AUDIO){l=false}else{if(typeof arguments[j]==="object"){n=arguments[j]}else{if(typeof arguments[j]==="function"){g=arguments[j]}}}}}if(navigator.getUserMedia){var h=document.createElement("video");if(!n){n={video:l,audio:k}}navigator.mediaDevices.getUserMedia(n).then(function(o){try{if("srcObject" in h){h.srcObject=o}else{h.src=window.URL.createObjectURL(o)}}catch(i){h.src=o}if(g){g(o)}},function(i){console.log(i)})}else{throw"getUserMedia not supported in this browser"}var m=d(h,this,true);m.loadedmetadata=false;h.addEventListener("loadedmetadata",function(){h.play();if(h.width){m.width=h.videoWidth=h.width;m.height=h.videoHeight=h.height}else{m.width=m.elt.width=h.videoWidth;m.height=m.elt.height=h.videoHeight}m.loadedmetadata=true});return m};b.prototype.createElement=function(g,i){b._validateParameters("createElement",arguments);var h=document.createElement(g);if(typeof i!=="undefined"){h.innerHTML=i}return d(h,this)};b.Element.prototype.addClass=function(g){if(this.elt.className){this.elt.className=this.elt.className+" "+g}else{this.elt.className=g}return this};b.Element.prototype.removeClass=function(h){var g=new RegExp("(?:^|\\s)"+h+"(?!\\S)");this.elt.className=this.elt.className.replace(g,"");this.elt.className=this.elt.className.replace(/^\s+|\s+$/g,"");return this};b.Element.prototype.child=function(g){if(typeof g==="undefined"){return this.elt.childNodes}if(typeof g==="string"){if(g[0]==="#"){g=g.substring(1)}g=document.getElementById(g)}else{if(g instanceof b.Element){g=g.elt}}this.elt.appendChild(g);return this};b.Element.prototype.center=function(l){var g=this.elt.style.display;var k=this.elt.style.display==="none";var j=this.parent().style.display==="none";var m={x:this.elt.offsetLeft,y:this.elt.offsetTop};if(k){this.show()}this.elt.style.display="block";this.position(0,0);if(j){this.parent().style.display="block"}var i=Math.abs(this.parent().offsetWidth-this.elt.offsetWidth);var h=Math.abs(this.parent().offsetHeight-this.elt.offsetHeight);var n=m.y;var o=m.x;if(l==="both"||l===undefined){this.position(i/2,h/2)}else{if(l==="horizontal"){this.position(i/2,n)}else{if(l==="vertical"){this.position(o,h/2)}}}this.style("display",g);if(k){this.hide()}if(j){this.parent().style.display="none"}return this};b.Element.prototype.html=function(){if(arguments.length===0){return this.elt.innerHTML}else{if(arguments[1]){this.elt.innerHTML+=arguments[0];return this}else{this.elt.innerHTML=arguments[0];return this}}};b.Element.prototype.position=function(){if(arguments.length===0){return{x:this.elt.offsetLeft,y:this.elt.offsetTop}}else{this.elt.style.position="absolute";this.elt.style.left=arguments[0]+"px";this.elt.style.top=arguments[1]+"px";this.x=arguments[0];this.y=arguments[1];return this}};b.Element.prototype._translate=function(){this.elt.style.position="absolute";var g="";if(this.elt.style.transform){g=this.elt.style.transform.replace(/translate3d\(.*\)/g,"");g=g.replace(/translate[X-Z]?\(.*\)/g,"")}if(arguments.length===2){this.elt.style.transform="translate("+arguments[0]+"px, "+arguments[1]+"px)"}else{if(arguments.length>2){this.elt.style.transform="translate3d("+arguments[0]+"px,"+arguments[1]+"px,"+arguments[2]+"px)";if(arguments.length===3){this.elt.parentElement.style.perspective="1000px"}else{this.elt.parentElement.style.perspective=arguments[3]+"px"}}}this.elt.style.transform+=g;return this};b.Element.prototype._rotate=function(){var g="";if(this.elt.style.transform){g=this.elt.style.transform.replace(/rotate3d\(.*\)/g,"");g=g.replace(/rotate[X-Z]?\(.*\)/g,"")}if(arguments.length===1){this.elt.style.transform="rotate("+arguments[0]+"deg)"}else{if(arguments.length===2){this.elt.style.transform="rotate("+arguments[0]+"deg, "+arguments[1]+"deg)"}else{if(arguments.length===3){this.elt.style.transform="rotateX("+arguments[0]+"deg)";this.elt.style.transform+="rotateY("+arguments[1]+"deg)";this.elt.style.transform+="rotateZ("+arguments[2]+"deg)"}}}this.elt.style.transform+=g;return this};b.Element.prototype.style=function(g,j){var q=this;if(j instanceof b.Color){j="rgba("+j.levels[0]+","+j.levels[1]+","+j.levels[2]+","+j.levels[3]/255+")"}if(typeof j==="undefined"){if(g.indexOf(":")===-1){var p=window.getComputedStyle(q.elt);var h=p.getPropertyValue(g);return h}else{var o=g.split(";");for(var m=0;m<o.length;m++){var l=o[m].split(":");if(l[0]&&l[1]){this.elt.style[l[0].trim()]=l[1].trim()}}}}else{if(g==="rotate"||g==="translate"||g==="position"){var r=Array.prototype.shift.apply(arguments);var n=this[r]||this["_"+r];n.apply(this,arguments)}else{this.elt.style[g]=j;if(g==="width"||g==="height"||g==="left"||g==="top"){var k=j.replace(/\D+/g,"");this[g]=parseInt(k,10)}}}return this};b.Element.prototype.attribute=function(g,j){if(this.elt.firstChild!=null&&(this.elt.firstChild.type==="checkbox"||this.elt.firstChild.type==="radio")){if(typeof j==="undefined"){return this.elt.firstChild.getAttribute(g)}else{for(var h=0;h<this.elt.childNodes.length;h++){this.elt.childNodes[h].setAttribute(g,j)}}}else{if(typeof j==="undefined"){return this.elt.getAttribute(g)}else{this.elt.setAttribute(g,j);return this}}};b.Element.prototype.removeAttribute=function(g){if(this.elt.firstChild!=null&&(this.elt.firstChild.type==="checkbox"||this.elt.firstChild.type==="radio")){for(var h=0;h<this.elt.childNodes.length;h++){this.elt.childNodes[h].removeAttribute(g)}}this.elt.removeAttribute(g);return this};b.Element.prototype.value=function(){if(arguments.length>0){this.elt.value=arguments[0];return this}else{if(this.elt.type==="range"){return parseFloat(this.elt.value)}else{return this.elt.value}}};b.Element.prototype.show=function(){this.elt.style.display="block";return this};b.Element.prototype.hide=function(){this.elt.style.display="none";return this};b.Element.prototype.size=function(i,o){if(arguments.length===0){return{width:this.elt.offsetWidth,height:this.elt.offsetHeight}}else{var p=i;var g=o;var n=b.prototype.AUTO;if(p!==n||g!==n){if(p===n){p=o*this.width/this.height}else{if(g===n){g=i*this.height/this.width}}if(this.elt instanceof HTMLCanvasElement){var m={};var l=this.elt.getContext("2d");var q;for(q in l){m[q]=l[q]}this.elt.setAttribute("width",p*this._pInst._pixelDensity);this.elt.setAttribute("height",g*this._pInst._pixelDensity);this.elt.setAttribute("style","width:"+p+"px; height:"+g+"px");this._pInst.scale(this._pInst._pixelDensity,this._pInst._pixelDensity);for(q in m){this.elt.getContext("2d")[q]=m[q]}}else{this.elt.style.width=p+"px";this.elt.style.height=g+"px";this.elt.width=p;this.elt.height=g;this.width=p;this.height=g}this.width=this.elt.offsetWidth;this.height=this.elt.offsetHeight;if(this._pInst){if(this._pInst._curElement.elt===this.elt){this._pInst._setProperty("width",this.elt.offsetWidth);this._pInst._setProperty("height",this.elt.offsetHeight)}}}return this}};b.Element.prototype.remove=function(){for(var g in this._events){this.elt.removeEventListener(g,this._events[g])}if(this.elt.parentNode){this.elt.parentNode.removeChild(this.elt)}delete this};b.MediaElement=function(h,i){b.Element.call(this,h,i);var g=this;this.elt.crossOrigin="anonymous";this._prevTime=0;this._cueIDCounter=0;this._cues=[];this._pixelDensity=1;this._modified=false;Object.defineProperty(g,"src",{get:function(){var l=g.elt.children[0].src;var k=g.elt.src===window.location.href?"":g.elt.src;var j=l===window.location.href?k:l;return j},set:function(l){for(var j=0;j<g.elt.children.length;j++){g.elt.removeChild(g.elt.children[j])}var k=document.createElement("source");k.src=l;h.appendChild(k);g.elt.src=l;g.modified=true}});g._onended=function(){};g.elt.onended=function(){g._onended(g)}};b.MediaElement.prototype=Object.create(b.Element.prototype);b.MediaElement.prototype.play=function(){if(this.elt.currentTime===this.elt.duration){this.elt.currentTime=0}if(this.elt.readyState>1){this.elt.play()}else{this.elt.load();this.elt.play()}return this};b.MediaElement.prototype.stop=function(){this.elt.pause();this.elt.currentTime=0;return this};b.MediaElement.prototype.pause=function(){this.elt.pause();return this};b.MediaElement.prototype.loop=function(){this.elt.setAttribute("loop",true);this.play();return this};b.MediaElement.prototype.noLoop=function(){this.elt.setAttribute("loop",false);return this};b.MediaElement.prototype.autoplay=function(g){this.elt.setAttribute("autoplay",g);return this};b.MediaElement.prototype.volume=function(g){if(typeof g==="undefined"){return this.elt.volume}else{this.elt.volume=g}};b.MediaElement.prototype.speed=function(g){if(typeof g==="undefined"){return this.elt.playbackRate}else{this.elt.playbackRate=g}};b.MediaElement.prototype.time=function(g){if(typeof g==="undefined"){return this.elt.currentTime}else{this.elt.currentTime=g}};b.MediaElement.prototype.duration=function(){return this.elt.duration};b.MediaElement.prototype.pixels=[];b.MediaElement.prototype.loadPixels=function(){if(!this.canvas){this.canvas=document.createElement("canvas");this.drawingContext=this.canvas.getContext("2d")}if(this.loadedmetadata){if(this.canvas.width!==this.elt.width){this.canvas.width=this.elt.width;this.canvas.height=this.elt.height;this.width=this.canvas.width;this.height=this.canvas.height}this.drawingContext.drawImage(this.elt,0,0,this.canvas.width,this.canvas.height);b.Renderer2D.prototype.loadPixels.call(this)}this.setModified(true);return this};b.MediaElement.prototype.updatePixels=function(g,k,i,j){if(this.loadedmetadata){b.Renderer2D.prototype.updatePixels.call(this,g,k,i,j)}this.setModified(true);return this};b.MediaElement.prototype.get=function(g,k,i,j){if(this.loadedmetadata){return b.Renderer2D.prototype.get.call(this,g,k,i,j)}else{if(typeof g==="undefined"){return new b.Image(1,1)}else{if(i>1){return new b.Image(g,k,i,j)}else{return[0,0,0,255]}}}};b.MediaElement.prototype.set=function(g,i,h){if(this.loadedmetadata){b.Renderer2D.prototype.set.call(this,g,i,h);this.setModified(true)}};b.MediaElement.prototype.copy=function(){b.Renderer2D.prototype.copy.apply(this,arguments)};b.MediaElement.prototype.mask=function(){this.loadPixels();this.setModified(true);b.Image.prototype.mask.apply(this,arguments)};b.MediaElement.prototype.isModified=function(){return this._modified};b.MediaElement.prototype.setModified=function(g){this._modified=g};b.MediaElement.prototype.onended=function(g){this._onended=g;return this};b.MediaElement.prototype.connect=function(i){var j,g;if(typeof b.prototype.getAudioContext==="function"){j=b.prototype.getAudioContext();g=b.soundOut.input}else{try{j=i.context;g=j.destination}catch(h){throw"connect() is meant to be used with Web Audio API or p5.sound.js"}}if(!this.audioSourceNode){this.audioSourceNode=j.createMediaElementSource(this.elt);this.audioSourceNode.connect(g)}if(i){if(i.input){this.audioSourceNode.connect(i.input)}else{this.audioSourceNode.connect(i)}}else{this.audioSourceNode.connect(g)}};b.MediaElement.prototype.disconnect=function(){if(this.audioSourceNode){this.audioSourceNode.disconnect()}else{throw"nothing to disconnect"}};b.MediaElement.prototype.showControls=function(){this.elt.style["text-align"]="inherit";this.elt.controls=true};b.MediaElement.prototype.hideControls=function(){this.elt.controls=false};var c=function(j,g,i,h){this.callback=j;this.time=g;this.id=i;this.val=h};b.MediaElement.prototype.addCue=function(h,k,i){var j=this._cueIDCounter++;var g=new c(k,h,j,i);this._cues.push(g);if(!this.elt.ontimeupdate){this.elt.ontimeupdate=this._onTimeUpdate.bind(this)}return j};b.MediaElement.prototype.removeCue=function(h){for(var g=0;g<this._cues.length;g++){if(this._cues[g].id===h){console.log(h);this._cues.splice(g,1)}}if(this._cues.length===0){this.elt.ontimeupdate=null}};b.MediaElement.prototype.clearCues=function(){this._cues=[];this.elt.ontimeupdate=null};b.MediaElement.prototype._onTimeUpdate=function(){var k=this.time();for(var h=0;h<this._cues.length;h++){var g=this._cues[h].time;var j=this._cues[h].val;if(this._prevTime<g&&g<=k){this._cues[h].callback(j)}}this._prevTime=k};b.File=function(g,h){this.file=g;this._pInst=h;var i=g.type.split("/");this.type=i[0];this.subtype=i[1];this.name=g.name;this.size=g.size;this.data=undefined}});